<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
  <view class="header-section">
    <view class="header-title">æˆ‘çš„è¡£æ©±</view>
    <view class="header-subtitle">å…± {{insights.totalCount}} ä»¶è¡£ç‰©</view>
  </view>

  <!-- æ•°æ®æ´å¯Ÿé¢æ¿ -->
  <view wx:if="{{!isEmpty && !loading}}" class="insights-panel">
    <view class="insights-header">
      <text class="insights-title">è¡£æ©±æ´å¯Ÿ</text>
    </view>
    
    <!-- æ€»æ•°ç»Ÿè®¡ -->
    <view class="insight-card total-card">
      <view class="insight-label">è¡£ç‰©æ€»æ•°</view>
      <view class="insight-value">{{insights.totalCount}}</view>
      <view class="insight-unit">ä»¶</view>
    </view>

    <!-- åˆ†ç±»ç»Ÿè®¡ -->
    <view wx:if="{{insights.categoryStats.length > 0}}" class="category-stats">
      <view class="stats-header">
        <text class="stats-title">åˆ†ç±»ç»Ÿè®¡</text>
      </view>
      <view class="stats-list">
        <view 
          class="stat-item" 
          wx:for="{{insights.categoryStats}}" 
          wx:key="category"
        >
          <view class="stat-category">{{item.category}}</view>
          <view class="stat-info">
            <text class="stat-count">{{item.count}}ä»¶</text>
            <text class="stat-percentage">{{item.percentage}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è´­ç‰©å»ºè®® -->
    <view wx:if="{{insights.shoppingSuggestions.length > 0}}" class="shopping-suggestions">
      <view class="suggestions-header">
        <text class="suggestions-title">ğŸ’¡ è´­ç‰©å»ºè®®</text>
      </view>
      <view class="suggestions-list">
        <view 
          class="suggestion-item" 
          wx:for="{{insights.shoppingSuggestions}}" 
          wx:key="index"
        >
          <text class="suggestion-text">{{item.message}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾ç­›é€‰å™¨ -->
  <view wx:if="{{!isEmpty && !loading}}" class="filter-section">
    <view class="filter-header">
      <text class="filter-title">ğŸ·ï¸ æ ‡ç­¾ç­›é€‰</text>
      <text wx:if="{{selectedFilterTags.length > 0}}" class="clear-filter" bindtap="clearFilters">æ¸…é™¤</text>
    </view>
    <view class="filter-tags">
      <view 
        class="filter-tag {{selectedFilterTags.indexOf(tag) !== -1 ? 'active' : ''}}"
        wx:for="{{allTags}}"
        wx:key="*this"
        data-tag="{{item}}"
        bindtap="toggleFilterTag"
      >
        <text>{{item}}</text>
      </view>
    </view>
    <view wx:if="{{selectedFilterTags.length > 0}}" class="filter-result">
      <text>å·²é€‰æ‹© {{selectedFilterTags.length}} ä¸ªæ ‡ç­¾ï¼Œæ˜¾ç¤º {{filteredItems.length}} ä»¶è¡£ç‰©</text>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
  <view class="quick-actions">
    <button class="primary-button" bindtap="goToAddItem">
      <text class="button-icon">+</text>
      <text>æ·»åŠ è¡£ç‰©</text>
    </button>
    <view class="secondary-buttons">
      <button class="secondary-button" bindtap="goToInspiration">
        <text class="button-icon">âœ¨</text>
        <text>ç©¿æ­çµæ„Ÿ</text>
      </button>
      <button class="secondary-button" bindtap="goToOutfits">
        <text class="button-icon">ğŸ“‹</text>
        <text>æˆ‘çš„æ­é…</text>
      </button>
    </view>
  </view>

  <!-- è¡£ç‰©ç½‘æ ¼åˆ—è¡¨ -->
  <view class="items-section">
    <skeleton wx:if="{{loading}}" type="grid" count="6"></skeleton>
    
    <empty-state 
      wx:elif="{{isEmpty}}"
      icon="ğŸ‘—"
      name="å°è”»"
      title="è¡£æ©±ç©ºç©ºå¦‚ä¹Ÿ"
      text="å¿«å»æ·»åŠ ç¬¬ä¸€ä»¶å¿ƒçˆ±è¡£ç‰©å§ï¼"
      button-text="æ·»åŠ ç¬¬ä¸€ä»¶è¡£ç‰©"
      bind:action="goToAddItem"
    ></empty-state>

    <view wx:else class="items-grid">
      <view 
        class="item-card {{selectionMode && selectedItemIds.indexOf(item.id) !== -1 ? 'selected' : ''}}"
        wx:for="{{filteredItems}}"
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="{{selectionMode ? 'toggleItemSelection' : 'viewItemDetail'}}"
      >
        <view class="item-image-wrapper">
          <image 
            class="item-image" 
            src="{{item.imageUrl || '/images/default-goods-image.png'}}" 
            mode="aspectFill"
            binderror="onImageError"
            data-index="{{index}}"
          ></image>
          <view wx:if="{{selectionMode && selectedItemIds.indexOf(item.id) !== -1}}" class="item-selected-overlay">
            <view class="item-selected-badge">
              <text>âœ“</text>
            </view>
          </view>
          <!-- åˆ é™¤èœå•æŒ‰é’® -->
          <view 
            wx:if="{{!selectionMode}}"
            class="item-menu-btn"
            data-id="{{item.id}}"
            catchtap="showItemMenu"
          >
            <text class="menu-icon">â‹®</text>
          </view>
        </view>
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <view class="item-tags">
            <view 
              class="item-tag"
              wx:for="{{item.tags}}"
              wx:for-item="tag"
              wx:key="*this"
            >
              <text>{{tag}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ“ä½œèœå•å¼¹çª— -->
    <view wx:if="{{showMenu}}" class="menu-modal-mask" catchtap="hideItemMenu">
      <view class="menu-modal-content" catchtap="">
        <view class="menu-item" data-action="edit" bindtap="handleMenuAction">
          <text class="menu-icon">âœï¸</text>
          <text class="menu-text">ç¼–è¾‘</text>
        </view>
        <view class="menu-item menu-item-danger" data-action="delete" bindtap="handleMenuAction">
          <text class="menu-icon">ğŸ—‘ï¸</text>
          <text class="menu-text">åˆ é™¤</text>
        </view>
        <view class="menu-cancel" catchtap="hideItemMenu">
          <text>å–æ¶ˆ</text>
        </view>
      </view>
    </view>
    
    <!-- å¤šé€‰æ¨¡å¼åº•éƒ¨æ“ä½œæ  -->
    <view wx:if="{{selectionMode && selectedItemIds.length > 0}}" class="selection-actions">
      <button class="create-outfit-btn" bindtap="createOutfitFromSelection">
        <text class="button-icon">ğŸ¨</text>
        <text>ç”Ÿæˆæ­é…å¡ç‰‡ ({{selectedItemIds.length}})</text>
      </button>
    </view>
  </view>
</view>
